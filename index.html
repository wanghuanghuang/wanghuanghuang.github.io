<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-本地IDEA调试远程服务器程序" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/23/本地IDEA调试远程服务器程序/" class="article-date">
  <time datetime="2018-10-23T07:48:53.000Z" itemprop="datePublished">2018-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/23/本地IDEA调试远程服务器程序/">本地IDEA调试远程服务器程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h2><p>首先，我们要让要让远程服务器支持远程调试功能，在项目启动项上追加特定的 JVM 参数即可，参数如下：<br>•   晚于 JDK 1.4.X 版本<br>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=4001<br>•    JDK 1.4.X 版本<br>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=4001<br>•    JDK 1.3.X 或早起版本<br>-Xnoagent -Djava.compiler=NONE -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=4001<br>大家根据不同的 JDK 版本使用不同的启动参数即可。本人使用的是 Tomcat 7 + Java 7 ，在 catalina.bat（linux 环境设置 catalina.sh）中设置 JAVA_OPTS 节点即可，“address=4001” 中的 “4001”为调试端口，大家可以根据需求自行设置（友情提示：不要占用网站的端口，有可能会导致项目启动报错）。</p>
<h2 id="IDE-配置"><a href="#IDE-配置" class="headerlink" title="IDE 配置"></a>IDE 配置</h2><p>然后，配置一下客户端就可以啦，Idea 的客户端配置非常简单在如下图所示的位置：<br><img src="/images/本地IDEA调试远程服务器程序/1.png" alt="1"><br>点击 Edit Configurations，即可进入 Run/Debug Configurations 界面:<br><img src="/images/本地IDEA调试远程服务器程序/2.png" alt="2"><br>点击左上角的“+”标识，可以在下拉框中发现“Remote”选项，选择确定后，出现右侧区域，首先在HOST（标注2）框中配置需要调试的远程服务器地址，然后在调试端口狂（标注3）中调试端口号（这里的端口号和服务器端的端口号保持一致，本示例中是“4001”），点击 OK 即可。</p>
<h2 id="调试步骤"><a href="#调试步骤" class="headerlink" title="调试步骤"></a>调试步骤</h2><p>最后，进入调试流程，整个项目的调试也非常简单，点击下图中的 debug 按钮，当 console 窗口中打印出 “Connected to the target VM, address: 127.0.0.1:4001’, transport: ‘socket’”即表示链接成功：<br><img src="/images/本地IDEA调试远程服务器程序/3.png" alt="3"><br>当然啦，也会有不顺利的情况出现，如：<br>•    服务器端口限制，比如服务器屏蔽了“4001”端口，会导致远程调试失败；<br>•    本地代码和远程代码不一致，也会导致远程代码调试失败；</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/23/本地IDEA调试远程服务器程序/" data-id="cjnv46xu6000ershx6nwm8ram" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-本地Eclipse调试远程服务器程序" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/23/本地Eclipse调试远程服务器程序/" class="article-date">
  <time datetime="2018-10-23T03:38:58.000Z" itemprop="datePublished">2018-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/23/本地Eclipse调试远程服务器程序/">本地Eclipse调试远程服务器程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-远程服务器：Java程序执行脚本添加配置"><a href="#1-远程服务器：Java程序执行脚本添加配置" class="headerlink" title="1.    远程服务器：Java程序执行脚本添加配置"></a>1.    远程服务器：Java程序执行脚本添加配置</h2><p><img src="/images/本地Eclipse调试远程服务器程序/eclipse1.png" alt="eclipse1"><br>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=54321<br>注意：address指向端口必须不同于原程序端口，让JVM可以区分调试和正常程序。使用docker的程序，需注意将调试端口暴露和映射出来。<br><a href="https://blog.csdn.net/lantian0802/article/details/40299377" target="_blank" rel="noopener">Java远程调试 java -Xdebug各参数说明</a></p>
<h2 id="2-本地：Eclipse配置"><a href="#2-本地：Eclipse配置" class="headerlink" title="2.    本地：Eclipse配置"></a>2.    本地：Eclipse配置</h2><p><img src="/images/本地Eclipse调试远程服务器程序/eclipse2.png" alt="eclipse2"><br><img src="/images/本地Eclipse调试远程服务器程序/eclipse3.png" alt="eclipse3"><br><img src="/images/本地Eclipse调试远程服务器程序/eclipse4.png" alt="eclipse4"> </p>
<h2 id="3-点击上图Debug按钮开始调试，远程系统的运行会反应在debug-pannel和断点上："><a href="#3-点击上图Debug按钮开始调试，远程系统的运行会反应在debug-pannel和断点上：" class="headerlink" title="3.   点击上图Debug按钮开始调试，远程系统的运行会反应在debug pannel和断点上："></a>3.   点击上图Debug按钮开始调试，远程系统的运行会反应在debug pannel和断点上：</h2><p><img src="/images/本地Eclipse调试远程服务器程序/eclipse5.png" alt="eclipse5"><br><img src="/images/本地Eclipse调试远程服务器程序/eclipse6.png" alt="eclipse6"> </p>
<h2 id="4-断开远程调试，按Disconnect"><a href="#4-断开远程调试，按Disconnect" class="headerlink" title="4.   断开远程调试，按Disconnect"></a>4.   断开远程调试，按Disconnect</h2><p><img src="/images/本地Eclipse调试远程服务器程序/eclipse7.png" alt="eclipse7"> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/23/本地Eclipse调试远程服务器程序/" data-id="cjnv46xu1000arshxltju8l5s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Sql中and、or、union、union-all-的用法" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/23/Sql中and、or、union、union-all-的用法/" class="article-date">
  <time datetime="2018-10-23T03:21:03.000Z" itemprop="datePublished">2018-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/23/Sql中and、or、union、union-all-的用法/">Sql中and、or、union、union all 的用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>And 是“和、并且”的意思<br>Or 是 “或者” 的意思<br>Union 与 union all 是 “联合” 的意思 区别为 union 去重 union all 不去重<br>举个例子：<br>    设计一张表 student<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `student` (</span><br><span class="line">  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</span><br><span class="line">  `name` varchar(10) DEFAULT NULL COMMENT &apos;姓名&apos;,</span><br><span class="line">  `sex` varchar(5) DEFAULT NULL COMMENT &apos;性别&apos;,</span><br><span class="line">  `age` int(5) DEFAULT NULL COMMENT &apos;年龄&apos;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure></p>
<p>添加数据如图：<br><img src="/images/Sql中and_or_union_union_all 的用法/数据图.png" alt="数据图"></p>
<ol>
<li>and 用法<br>挑选性别是男并且年龄为30岁的姓名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL：</span><br><span class="line">   	Select s.name from student s where sex = &apos;男&apos; and age = 30</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/images/Sql中and_or_union_union_all 的用法/and结果图.png" alt="and结果图"></p>
<ol start="2">
<li>or 用法<br>挑选年龄为22 或 30 的人<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SQL：</span><br><span class="line">	Select s.name from student s where age = 22 or age = 30</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/images/Sql中and_or_union_union_all 的用法/or结果图.png" alt="or结果图"></p>
<ol start="3">
<li>union 用法 </li>
<li>union all 用法<br>是联合查询 union 是A 条件的结果加上B条件的结果去重<br>Union all 是A 条件的结果加上B条件的结果 不去重 与or 相似</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/23/Sql中and、or、union、union-all-的用法/" data-id="cjnv46xte0001rshxrs909jg3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx-转发-域名配置" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/22/Nginx-转发-域名配置/" class="article-date">
  <time datetime="2018-10-22T09:34:37.000Z" itemprop="datePublished">2018-10-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/22/Nginx-转发-域名配置/">Nginx 转发 + 域名配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="服务器中nginx-配置文件位置："><a href="#服务器中nginx-配置文件位置：" class="headerlink" title="服务器中nginx 配置文件位置："></a>服务器中nginx 配置文件位置：</h2><p><img src="/images/Nginx 转发_域名配置/nginx图片.png" alt="nginx图片"></p>
<h3 id="1-nginx-conf"><a href="#1-nginx-conf" class="headerlink" title="1.nginx.conf"></a>1.nginx.conf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">a)文件内容：</span><br><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; </span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_cookie&quot; &quot;$request_time&quot; &quot;$upstream_response_time&quot; &quot;$upstream_cache_status&quot; &quot;$guid&quot;&apos;;</span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_min_length  1k;         #最小压缩大小</span><br><span class="line">    gzip_buffers     4 16k;        #压缩缓冲区</span><br><span class="line">    gzip_http_version 1.0;       #压缩版本</span><br><span class="line">    gzip_comp_level 2;            #压缩等级</span><br><span class="line">    gzip_types       text/plain application/x-javascript text/css application/xml;           #压缩类型</span><br><span class="line"></span><br><span class="line">    #引用配置</span><br><span class="line">    include /usr/local/nginx/conf/localhost.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-localhost-conf"><a href="#2-localhost-conf" class="headerlink" title="2.localhost.conf"></a>2.localhost.conf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br></pre></td><td class="code"><pre><span class="line">a)	文件内容：</span><br><span class="line">upstream http_webapi_test &#123;</span><br><span class="line">    server 127.0.0.1:8889;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_quartz_test &#123;</span><br><span class="line">    server 127.0.0.1:8011;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_auth_test &#123;</span><br><span class="line">    server 127.0.0.1:8051;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_webapi_insurance &#123;</span><br><span class="line">    server 127.0.0.1:8041;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_webapi_risk &#123;</span><br><span class="line">    server 127.0.0.1:8071;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_brand_test &#123;</span><br><span class="line">    server 127.0.0.1:8021;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_wechat &#123;</span><br><span class="line">    server 127.0.0.1:8061;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_policy &#123;</span><br><span class="line">    server 127.0.0.1:8077;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_intelligent_cabinet &#123;</span><br><span class="line">    server 127.0.0.1:8201;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">upstream http_intelligent_wechat &#123;</span><br><span class="line">    server 127.0.0.1:8301;</span><br><span class="line">    keepalive 16;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen       80;            若为端口号80访问进入服务</span><br><span class="line">  #server_name  p.boiotech.com;</span><br><span class="line">  server_name  localhost;</span><br><span class="line">  #charset koi8-r;</span><br><span class="line">  set $guid &quot;-&quot;;</span><br><span class="line">  #if ( $http_cookie ~* &quot;uid=(\S+)(;.*|$)&quot;)&#123;</span><br><span class="line">  if ($http_cookie ~* &quot;CSID=([A-Z0-9]*)&quot;)&#123;</span><br><span class="line">  #if($http_cookie ~* &quot;(.*)$&quot;)&#123;</span><br><span class="line">      set $guid $1;</span><br><span class="line">  &#125;</span><br><span class="line">  access_log /var/log/nginx/localhost/host.access80_new.log  main;  转发日志</span><br><span class="line">   location ~ /api(\/)+ &#123;			url中带有api转发至此  下面同理</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      60;</span><br><span class="line">        proxy_read_timeout      60;</span><br><span class="line">        proxy_pass http://http_webapi_test;</span><br><span class="line">       #proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /api-insurance(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      30;</span><br><span class="line">        proxy_read_timeout      30;</span><br><span class="line">        proxy_pass http://http_webapi_insurance;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">   location ~ /quartz(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      30;</span><br><span class="line">        proxy_read_timeout      30;</span><br><span class="line">        proxy_pass http://http_quartz_test;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /auth(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      30;</span><br><span class="line">        proxy_read_timeout      30;</span><br><span class="line">        proxy_pass http://http_auth_test;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location /webSocketServer/ &#123;</span><br><span class="line">        proxy_pass http://http_intelligent_cabinet;</span><br><span class="line">        # WebScoket Support</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    &#125;	</span><br><span class="line">  location ~ /api-cabinet(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   18000;</span><br><span class="line">        proxy_send_timeout      18000;</span><br><span class="line">        proxy_read_timeout      18000;</span><br><span class="line">        proxy_pass http://http_intelligent_cabinet;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /api-intelligent-wechat(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   18000;</span><br><span class="line">        proxy_send_timeout      18000;</span><br><span class="line">        proxy_read_timeout      18000;</span><br><span class="line">        proxy_pass http://http_intelligent_wechat;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">   location ~ /favicon\.ico$ &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;		</span><br><span class="line">  location / &#123;</span><br><span class="line">        root   /usr/local/nginx/html-rfid;     前端PC代码发布地</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen       5600;</span><br><span class="line">  server_name  localhost;</span><br><span class="line">  #charset koi8-r;</span><br><span class="line">  set $guid &quot;-&quot;;</span><br><span class="line">  #if ( $http_cookie ~* &quot;uid=(\S+)(;.*|$)&quot;)&#123;</span><br><span class="line">  if ($http_cookie ~* &quot;CSID=([A-Z0-9]*)&quot;)&#123;</span><br><span class="line">  #if($http_cookie ~* &quot;(.*)$&quot;)&#123;</span><br><span class="line">      set $guid $1;</span><br><span class="line">  &#125;</span><br><span class="line">  access_log /var/log/nginx/localhost/host.access_5600.log  main;</span><br><span class="line">   location ~ /api(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      60;</span><br><span class="line">        proxy_read_timeout      60;</span><br><span class="line">        proxy_pass http://http_webapi_test;</span><br><span class="line">       #proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /auth(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      30;</span><br><span class="line">        proxy_read_timeout      30;</span><br><span class="line">        proxy_pass http://http_auth_test;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">   location /webSocketServer/ &#123;</span><br><span class="line">        proxy_pass http://http_intelligent_cabinet;</span><br><span class="line">        # WebScoket Support</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    &#125;		</span><br><span class="line">   location ~ /api-cabinet(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   18000;</span><br><span class="line">        proxy_send_timeout      18000;</span><br><span class="line">        proxy_read_timeout      18000;</span><br><span class="line">        proxy_pass http://http_intelligent_cabinet;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/local/nginx/html-rfid;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">        #index  index.html index.htm;</span><br><span class="line">    &#125; </span><br><span class="line">   location ~ /favicon\.ico$ &#123;</span><br><span class="line">            root   html-rfid;</span><br><span class="line">        &#125;</span><br><span class="line">  error_page   500 502 503 504  /50x/50x.html;</span><br><span class="line">  location = /50x.html &#123;</span><br><span class="line">    root   html-rfid;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen       5700;</span><br><span class="line">  server_name  localhost;</span><br><span class="line">  #charset koi8-r;</span><br><span class="line">  set $guid &quot;-&quot;;</span><br><span class="line">  #if ( $http_cookie ~* &quot;uid=(\S+)(;.*|$)&quot;)&#123;</span><br><span class="line">  if ($http_cookie ~* &quot;CSID=([A-Z0-9]*)&quot;)&#123;</span><br><span class="line">  #if($http_cookie ~* &quot;(.*)$&quot;)&#123;</span><br><span class="line">      set $guid $1;</span><br><span class="line">  &#125;</span><br><span class="line">  access_log /var/log/nginx/localhost/host.access_5700.log  main;</span><br><span class="line">   location ~ /api(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      60;</span><br><span class="line">        proxy_read_timeout      60;</span><br><span class="line">        proxy_pass http://http_webapi_test;</span><br><span class="line">       #proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /auth(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   3;</span><br><span class="line">        proxy_send_timeout      30;</span><br><span class="line">        proxy_read_timeout      30;</span><br><span class="line">        proxy_pass http://http_auth_test;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;		</span><br><span class="line">   location ~ /api-cabinet(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   18000;</span><br><span class="line">        proxy_send_timeout      18000;</span><br><span class="line">        proxy_read_timeout      18000;</span><br><span class="line">        proxy_pass http://http_intelligent_cabinet;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /api-intelligent-wechat(\/)+ &#123;</span><br><span class="line">        proxy_redirect          off;</span><br><span class="line">        proxy_set_header        Host            $host;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size    10m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffers           32 4k;</span><br><span class="line">        proxy_connect_timeout   18000;</span><br><span class="line">        proxy_send_timeout      18000;</span><br><span class="line">        proxy_read_timeout      18000;</span><br><span class="line">        proxy_pass http://http_intelligent_wechat;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header        Connection      &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/local/nginx/html-rfid-weixin;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">        #index  index.html index.htm;</span><br><span class="line">    &#125; </span><br><span class="line">   location ~ /favicon\.ico$ &#123;</span><br><span class="line">            root   html-rfid-weixin;</span><br><span class="line">        &#125;</span><br><span class="line">  error_page   500 502 503 504  /50x/50x.html;</span><br><span class="line">  location = /50x.html &#123;</span><br><span class="line">    root   html-rfid-weixin;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>域名转发 端口号要为8080 端口 域名指向端口号为80的 ip   nginx文件中 要对外开放80端口<br>一个服务器中 一个端口号不可对应两个工程 若有两个域名转发 另一个要用负载均衡转发 ip + 80端口 指向端口号不为80的工程ip<br>配置完 服务器中的配置 需要改为域名</p>
<p><img src="/images/Nginx 转发_域名配置/规则.png" alt="规则"></p>
<p><a href="https://www.cnblogs.com/knowledgesea/p/5175711.html" target="_blank" rel="noopener">参考链接1</a>  </p>
<p><a href="https://www.jb51.net/article/45076.htm" target="_blank" rel="noopener">参考链接2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/22/Nginx-转发-域名配置/" data-id="cjnv46xtk0003rshx2s5f61us" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-inert-into-select语句使用" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/16/inert-into-select语句使用/" class="article-date">
  <time datetime="2018-10-16T03:51:38.000Z" itemprop="datePublished">2018-10-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/16/inert-into-select语句使用/">inert-into-select语句使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Insert into select 语句 顾名思义 就是 插入一查询出来的数据<br>举一个例子：<br>现有一个表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sys_group_tag表：</span><br><span class="line">CREATE TABLE `sys_group_tag` (</span><br><span class="line">  `id` int(10) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `GROUP_ID` int(10) DEFAULT NULL,</span><br><span class="line">  `TAG_ID` int(10) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `idx` (`GROUP_ID`,`TAG_ID`) USING HASH</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=65 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sys_tag表：</span><br><span class="line">CREATE TABLE `sys_tag` (</span><br><span class="line">  `id` int(10) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `tag_name` varchar(100) DEFAULT NULL COMMENT &apos;tag标签&apos;,</span><br><span class="line">  `tag_type` tinyint(3) DEFAULT NULL COMMENT &apos;标签类型  1第一受益人2催收 3 关注&apos;,</span><br><span class="line">  `memo` varchar(254) DEFAULT NULL COMMENT &apos;注释&apos;,</span><br><span class="line">  `create_id` int(10) DEFAULT NULL COMMENT &apos;创建人&apos;,</span><br><span class="line">  `create_time` datetime DEFAULT NULL COMMENT &apos;创建时间&apos;,</span><br><span class="line">  `update_id` int(10) DEFAULT NULL COMMENT &apos;更新人&apos;,</span><br><span class="line">  `update_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;更新时间&apos;,</span><br><span class="line">  `ISDEL` tinyint(3) DEFAULT &apos;0&apos; COMMENT &apos;删除标记 0 可用 1 不可用&apos;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<p>现有业务为：向sys_group_tag表中插入数据：group_id为1固定,tag_id是筛选sys_tag表中所有tag_type为1 并且未删除的id；<br>在navicat工具中 无法用表达式#{} 集合遍历直接写出,这时就用到insert into select<br>实际语句为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO </span><br><span class="line">dd_uni.sys_group_tag </span><br><span class="line">(group_id, tag_id)  </span><br><span class="line">select &apos;1&apos;,id </span><br><span class="line">from </span><br><span class="line">sys_tag </span><br><span class="line">where </span><br><span class="line">tag_type = 1 </span><br><span class="line">AND isdel=0</span><br></pre></td></tr></table></figure></p>
<p>不需要values，不需要括号 及时 两个select union查询 也不需要<br>还有一种是 若是在配置文件中如何编写？<br>现在讲解一种业务：还是上方两个表 但是 这次要插入的group_id不一定为1 是一个变化值，则实际sql为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;saveUserTag&quot;&gt;</span><br><span class="line">INSERT INTO</span><br><span class="line">   dd_uni.sys_group_tag</span><br><span class="line">   (group_id,tag_id)</span><br><span class="line">  SELECT</span><br><span class="line">	#&#123;group_id&#125;,</span><br><span class="line">	id</span><br><span class="line">  FROM</span><br><span class="line">    sys_tag</span><br><span class="line">  WHERE</span><br><span class="line">    tag_type = 1</span><br><span class="line">    AND isdel = 0</span><br><span class="line">&lt;/insert&gt; </span><br><span class="line">(#&#123;group_id&#125; 是传入的变化的值)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/16/inert-into-select语句使用/" data-id="cjnv46xts0008rshxer6g9xvc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-idea查看依赖关系" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/16/idea查看依赖关系/" class="article-date">
  <time datetime="2018-10-16T03:28:32.000Z" itemprop="datePublished">2018-10-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/16/idea查看依赖关系/">idea查看依赖关系</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/依赖图片.png" alt="依赖图片"></p>
<h2 id="1-选择右侧Maven-Projects"><a href="#1-选择右侧Maven-Projects" class="headerlink" title="1.选择右侧Maven Projects"></a>1.选择右侧Maven Projects</h2><h2 id="2-选中一个模块"><a href="#2-选中一个模块" class="headerlink" title="2.选中一个模块"></a>2.选中一个模块</h2><h2 id="3-点击show-Dependencies"><a href="#3-点击show-Dependencies" class="headerlink" title="3.点击show Dependencies"></a>3.点击show Dependencies</h2><h2 id="4-出现依赖关系图"><a href="#4-出现依赖关系图" class="headerlink" title="4.出现依赖关系图"></a>4.出现依赖关系图</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/16/idea查看依赖关系/" data-id="cjnv46xtm0004rshxjboauojg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/idea/">idea</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-服务器restart-sh脚本中的含义" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/14/服务器restart-sh脚本中的含义/" class="article-date">
  <time datetime="2018-09-14T09:09:22.000Z" itemprop="datePublished">2018-09-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/14/服务器restart-sh脚本中的含义/">服务器restart.sh脚本中的含义</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Restart-sh-脚本内容："><a href="#Restart-sh-脚本内容：" class="headerlink" title="Restart.sh 脚本内容："></a>Restart.sh 脚本内容：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 重启</span><br><span class="line">echo &quot;restart diditech-iov-unify-webapi-8300 service&quot;</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/maindisk/jdk1.8.0_151</span><br><span class="line">echo $&#123;JAVA_HOME&#125;</span><br><span class="line">dir_base=/app/diditech-iov-unify-webapi/8300</span><br><span class="line">cd $&#123;dir_base&#125;</span><br><span class="line">echo &apos;deploying...&apos;</span><br><span class="line">jar_name=&apos;diditech-iov-unify-webapi.jar&apos;</span><br><span class="line">pid=`ps -ef | grep diditech-iov-unify-webapi | grep 8300 | grep &quot;java&quot; | awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">if [ -n &quot;$pid&quot; ]</span><br><span class="line">then</span><br><span class="line">   kill -9 $pid</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo $&#123;dir_base&#125;/$&#123;jar_name&#125;</span><br><span class="line">nohup $&#123;JAVA_HOME&#125;/bin/java -jar  $&#123;dir_base&#125;/$&#123;jar_name&#125; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 2</span><br><span class="line">echo &apos;ok!&apos;</span><br></pre></td></tr></table></figure>
<h2 id="一．echo命令"><a href="#一．echo命令" class="headerlink" title="一．echo命令"></a>一．echo命令</h2><p>Shell的echo指令与PHP的echo指令类似，都是用于字符串的输出。<br>a)    显示普通字符串<br>i.    echo “It is a test”    echo It is a test<br>这里的双引号完全可以忽略 效果是一样的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[rootelocalhost ～]# echo &quot;It is a test&quot;</span><br><span class="line">&quot;It is a test&quot;</span><br><span class="line">[root@localhost ～]# echo It is a test</span><br><span class="line">It is a test</span><br><span class="line">[root@localhost~]#</span><br></pre></td></tr></table></figure></p>
<p>ii.    含有转义字符时 若不加引号 则会丢失信息  “”内信息会完整展示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[rootelocalhost 8201]# echo OK!\n OK!n</span><br><span class="line">[rootelocalhost 8201]# echo &quot;OK!\n&quot;</span><br><span class="line">OK!\n</span><br></pre></td></tr></table></figure></p>
<p>b)    显示转移字符<br>i.    echo “\”It is a test\””   echo \”It is a test\”<br>这里引号也是可以省略的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ～]# echo &quot;\&quot;It is a test\&quot;&quot;</span><br><span class="line">&quot;It is a test&quot;</span><br><span class="line">[rootelocalhost ～]# echo \&quot; It is a test \&quot;</span><br><span class="line">&quot;It is a test &quot;</span><br></pre></td></tr></table></figure></p>
<p>c)    显示变量<br>先编辑一个test.sh的脚本</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/14/服务器restart-sh脚本中的含义/" data-id="cjnv46xu00009rshxvv1y0r5g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/服务器restart-sh脚本中的含义/">服务器restart.sh脚本中的含义</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用命令行把项目部署到github" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/14/用命令行把项目部署到github/" class="article-date">
  <time datetime="2018-09-14T09:01:54.000Z" itemprop="datePublished">2018-09-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/14/用命令行把项目部署到github/">用命令行把项目部署到github</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-项目首次提交到github上"><a href="#1-项目首次提交到github上" class="headerlink" title="1.项目首次提交到github上"></a>1.项目首次提交到github上</h2><p>a)    打开项目所在文件位置，右击点击Git Bash Here.<br>b)    $git init         //初始化<br>c)    $git commit –m ‘第一次提交’    //提交，并注释信息“第一次提交”<br>d)    $git remote add origin <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:{github用户名}/{repository名}.git    //链接远程github项目<br>e)    $git push –u origin master     //将本地项目提交到GitHub项目上去</p>
<h2 id="2-删除GitHub上的文件"><a href="#2-删除GitHub上的文件" class="headerlink" title="2.删除GitHub上的文件"></a>2.删除GitHub上的文件</h2><p>a)    打开项目所在的文件位置，右击点击git bash here<br>b)    $git pull origin master     //将远程仓库上的项目拉取下来<br>c)    $dir         //查看有哪些文件夹<br>d)    $git rm –r –cached 文件名        //删除某文件<br>e)    $git commit –m ‘删除说明’        //提交，添加说明<br>f)    $git push –u origin master         //将本次更改提交到GitHub项目上去<br>注意：<br>本地项目中的文件不会被删除，不会影响本地文件操作。删除的只是远程仓库中的文件。<br>每次增加文件或删除文件，都要commit然后直接git push –u origin master,就可以同步到GitHub上了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/14/用命令行把项目部署到github/" data-id="cjnv46xu3000drshxgx1al9hb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/用命令行把项目部署到github/">用命令行把项目部署到github</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pageHelper-分页应用" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/14/pageHelper-分页应用/" class="article-date">
  <time datetime="2018-09-14T06:08:26.000Z" itemprop="datePublished">2018-09-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/14/pageHelper-分页应用/">pageHelper 分页应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-pagehelper-分页原理"><a href="#1-pagehelper-分页原理" class="headerlink" title="1.pagehelper 分页原理"></a>1.pagehelper 分页原理</h2><p>pageHelper 是做什么的呢？他是封装了分页的后台部分，说的简单一点，就是你不需要每个POJO类的增删改查里都包括那两个方法了，他帮你做了。你只需要有一个selectAll的方法，他会根据你使用的数据库将你selectAll的sql改装成一个分页查询的SQL，并顺带生成一个查询总数的SQL。</p>
<h3 id="1-1-如何进行拦截的呢？"><a href="#1-1-如何进行拦截的呢？" class="headerlink" title="1.1 如何进行拦截的呢？"></a>1.1 如何进行拦截的呢？</h3><p>通常我们使用这个插件的，配置一个拦截器“com.github.pagehelper.PageInterceptor”，让我们看看这个拦截器里面做了什么操作？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * The MIT License (MIT)</span><br><span class="line"> *</span><br><span class="line"> * Copyright (c) 2014-2017 abel533@gmail.com</span><br><span class="line"> *</span><br><span class="line"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line"> * of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line"> * in the Software without restriction, including without limitation the rights</span><br><span class="line"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line"> * copies of the Software, and to permit persons to whom the Software is</span><br><span class="line"> * furnished to do so, subject to the following conditions:</span><br><span class="line"> *</span><br><span class="line"> * The above copyright notice and this permission notice shall be included in</span><br><span class="line"> * all copies or substantial portions of the Software.</span><br><span class="line"> *</span><br><span class="line"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span><br><span class="line"> * THE SOFTWARE.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">package com.github.pagehelper;</span><br><span class="line"></span><br><span class="line">import com.github.pagehelper.cache.Cache;</span><br><span class="line">import com.github.pagehelper.cache.CacheFactory;</span><br><span class="line">import com.github.pagehelper.util.MSUtils;</span><br><span class="line">import com.github.pagehelper.util.StringUtil;</span><br><span class="line">import org.apache.ibatis.cache.CacheKey;</span><br><span class="line">import org.apache.ibatis.executor.Executor;</span><br><span class="line">import org.apache.ibatis.mapping.BoundSql;</span><br><span class="line">import org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line">import org.apache.ibatis.plugin.*;</span><br><span class="line">import org.apache.ibatis.session.ResultHandler;</span><br><span class="line">import org.apache.ibatis.session.RowBounds;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mybatis - 通用分页拦截器&lt;br/&gt;</span><br><span class="line"> * 项目地址 : http://git.oschina.net/free/Mybatis_PageHelper</span><br><span class="line"> *</span><br><span class="line"> * @author liuzh/abel533/isea533</span><br><span class="line"> * @version 5.0.0</span><br><span class="line"> */</span><br><span class="line">@SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)</span><br><span class="line">@Intercepts(</span><br><span class="line">    &#123;</span><br><span class="line">        @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;),</span><br><span class="line">        @Signature(type = Executor.class, method = &quot;query&quot;, args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class, CacheKey.class, BoundSql.class&#125;),</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">public class PageInterceptor implements Interceptor &#123;</span><br><span class="line">    //缓存count查询的ms</span><br><span class="line">    protected Cache&lt;CacheKey, MappedStatement&gt; msCountMap = null;</span><br><span class="line">    private Dialect dialect;</span><br><span class="line">    private String default_dialect_class = &quot;com.github.pagehelper.PageHelper&quot;;</span><br><span class="line">    private Field additionalParametersField;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Object[] args = invocation.getArgs();</span><br><span class="line">            MappedStatement ms = (MappedStatement) args[0];</span><br><span class="line">            Object parameter = args[1];</span><br><span class="line">            RowBounds rowBounds = (RowBounds) args[2];</span><br><span class="line">            ResultHandler resultHandler = (ResultHandler) args[3];</span><br><span class="line">            Executor executor = (Executor) invocation.getTarget();</span><br><span class="line">            CacheKey cacheKey;</span><br><span class="line">            BoundSql boundSql;</span><br><span class="line">            //由于逻辑关系，只会进入一次</span><br><span class="line">            if(args.length == 4)&#123;</span><br><span class="line">                //4 个参数时</span><br><span class="line">                boundSql = ms.getBoundSql(parameter);</span><br><span class="line">                cacheKey = executor.createCacheKey(ms, parameter, rowBounds, boundSql);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //6 个参数时</span><br><span class="line">                cacheKey = (CacheKey) args[4];</span><br><span class="line">                boundSql = (BoundSql) args[5];</span><br><span class="line">            &#125;</span><br><span class="line">            List resultList;</span><br><span class="line">            //调用方法判断是否需要进行分页，如果不需要，直接返回结果</span><br><span class="line">            if (!dialect.skip(ms, parameter, rowBounds)) &#123;</span><br><span class="line">                //反射获取动态参数</span><br><span class="line">                Map&lt;String, Object&gt; additionalParameters = (Map&lt;String, Object&gt;) additionalParametersField.get(boundSql);</span><br><span class="line">                //判断是否需要进行 count 查询</span><br><span class="line">                if (dialect.beforeCount(ms, parameter, rowBounds)) &#123;</span><br><span class="line">                    //创建 count 查询的缓存 key</span><br><span class="line">                    CacheKey countKey = executor.createCacheKey(ms, parameter, RowBounds.DEFAULT, boundSql);</span><br><span class="line">                    countKey.update(&quot;_Count&quot;);</span><br><span class="line">                    MappedStatement countMs = msCountMap.get(countKey);</span><br><span class="line">                    if (countMs == null) &#123;</span><br><span class="line">                        //根据当前的 ms 创建一个返回值为 Long 类型的 ms</span><br><span class="line">                        countMs = MSUtils.newCountMappedStatement(ms);</span><br><span class="line">                        msCountMap.put(countKey, countMs);</span><br><span class="line">                    &#125;</span><br><span class="line">                    //调用方言获取 count sql</span><br><span class="line">                    String countSql = dialect.getCountSql(ms, boundSql, parameter, rowBounds, countKey);</span><br><span class="line">                    BoundSql countBoundSql = new BoundSql(ms.getConfiguration(), countSql, boundSql.getParameterMappings(), parameter);</span><br><span class="line">                    //当使用动态 SQL 时，可能会产生临时的参数，这些参数需要手动设置到新的 BoundSql 中</span><br><span class="line">                    for (String key : additionalParameters.keySet()) &#123;</span><br><span class="line">                        countBoundSql.setAdditionalParameter(key, additionalParameters.get(key));</span><br><span class="line">                    &#125;</span><br><span class="line">                    //执行 count 查询</span><br><span class="line">                    Object countResultList = executor.query(countMs, parameter, RowBounds.DEFAULT, resultHandler, countKey, countBoundSql);</span><br><span class="line">                    Long count = (Long) ((List) countResultList).get(0);</span><br><span class="line">                    //处理查询总数</span><br><span class="line">                    //返回 true 时继续分页查询，false 时直接返回</span><br><span class="line">                    if (!dialect.afterCount(count, parameter, rowBounds)) &#123;</span><br><span class="line">                        //当查询总数为 0 时，直接返回空的结果</span><br><span class="line">                        return dialect.afterPage(new ArrayList(), parameter, rowBounds);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                //判断是否需要进行分页查询</span><br><span class="line">                if (dialect.beforePage(ms, parameter, rowBounds)) &#123;</span><br><span class="line">                    //生成分页的缓存 key</span><br><span class="line">                    CacheKey pageKey = cacheKey;</span><br><span class="line">                    //处理参数对象</span><br><span class="line">                    parameter = dialect.processParameterObject(ms, parameter, boundSql, pageKey);</span><br><span class="line">                    //调用方言获取分页 sql</span><br><span class="line">                    String pageSql = dialect.getPageSql(ms, boundSql, parameter, rowBounds, pageKey);</span><br><span class="line">                    BoundSql pageBoundSql = new BoundSql(ms.getConfiguration(), pageSql, boundSql.getParameterMappings(), parameter);</span><br><span class="line">                    //设置动态参数</span><br><span class="line">                    for (String key : additionalParameters.keySet()) &#123;</span><br><span class="line">                        pageBoundSql.setAdditionalParameter(key, additionalParameters.get(key));</span><br><span class="line">                    &#125;</span><br><span class="line">                    //执行分页查询</span><br><span class="line">                    resultList = executor.query(ms, parameter, RowBounds.DEFAULT, resultHandler, pageKey, pageBoundSql);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    //不执行分页的情况下，也不执行内存分页</span><br><span class="line">                    resultList = executor.query(ms, parameter, RowBounds.DEFAULT, resultHandler, cacheKey, boundSql);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                //rowBounds用参数值，不使用分页插件处理时，仍然支持默认的内存分页</span><br><span class="line">                resultList = executor.query(ms, parameter, rowBounds, resultHandler, cacheKey, boundSql);</span><br><span class="line">            &#125;</span><br><span class="line">            return dialect.afterPage(resultList, parameter, rowBounds);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            dialect.afterAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object plugin(Object target) &#123;</span><br><span class="line">        return Plugin.wrap(target, this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setProperties(Properties properties) &#123;</span><br><span class="line">        //缓存 count ms</span><br><span class="line">        msCountMap = CacheFactory.createCache(properties.getProperty(&quot;msCountCache&quot;), &quot;ms&quot;, properties);</span><br><span class="line">        String dialectClass = properties.getProperty(&quot;dialect&quot;);</span><br><span class="line">        if (StringUtil.isEmpty(dialectClass)) &#123;</span><br><span class="line">            dialectClass = default_dialect_class;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class&lt;?&gt; aClass = Class.forName(dialectClass);</span><br><span class="line">            dialect = (Dialect) aClass.newInstance();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new PageException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        dialect.setProperties(properties);</span><br><span class="line">        try &#123;</span><br><span class="line">            //反射获取 BoundSql 中的 additionalParameters 属性</span><br><span class="line">            additionalParametersField = BoundSql.class.getDeclaredField(&quot;additionalParameters&quot;);</span><br><span class="line">            additionalParametersField.setAccessible(true);</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            throw new PageException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过源代码发现：拦截器会根据参数来判断使用需要进行的物理分页，不使用分页插件处理时，仍支持默认的内存分页。需要分页时候，根据条件判断是否需要count和limit处理。</p>
<h3 id="1-2-如何处理分页的逻辑"><a href="#1-2-如何处理分页的逻辑" class="headerlink" title="1.2 如何处理分页的逻辑"></a>1.2 如何处理分页的逻辑</h3><p>对应不同的数据库有不同的方言，如常见的Mysql，分页关键字：limit，它是如此组装你的SQL：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * The MIT License (MIT)</span><br><span class="line"> *</span><br><span class="line"> * Copyright (c) 2014-2017 abel533@gmail.com</span><br><span class="line"> *</span><br><span class="line"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line"> * of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line"> * in the Software without restriction, including without limitation the rights</span><br><span class="line"> * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line"> * copies of the Software, and to permit persons to whom the Software is</span><br><span class="line"> * furnished to do so, subject to the following conditions:</span><br><span class="line"> *</span><br><span class="line"> * The above copyright notice and this permission notice shall be included in</span><br><span class="line"> * all copies or substantial portions of the Software.</span><br><span class="line"> *</span><br><span class="line"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line"> * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span><br><span class="line"> * THE SOFTWARE.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">package com.github.pagehelper.dialect.rowbounds;</span><br><span class="line"></span><br><span class="line">import com.github.pagehelper.dialect.AbstractRowBoundsDialect;</span><br><span class="line">import org.apache.ibatis.cache.CacheKey;</span><br><span class="line">import org.apache.ibatis.session.RowBounds;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * mysql 基于 RowBounds 的分页</span><br><span class="line"> *</span><br><span class="line"> * @author liuzh</span><br><span class="line"> */</span><br><span class="line">public class MySqlRowBoundsDialect extends AbstractRowBoundsDialect &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getPageSql(String sql, RowBounds rowBounds, CacheKey pageKey) &#123;</span><br><span class="line">        StringBuilder sqlBuilder = new StringBuilder(sql.length() + 14);</span><br><span class="line">        sqlBuilder.append(sql);</span><br><span class="line">        if (rowBounds.getOffset() == 0) &#123;</span><br><span class="line">            sqlBuilder.append(&quot; LIMIT &quot;);</span><br><span class="line">            sqlBuilder.append(rowBounds.getLimit());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            sqlBuilder.append(&quot; LIMIT &quot;);</span><br><span class="line">            sqlBuilder.append(rowBounds.getOffset());</span><br><span class="line">            sqlBuilder.append(&quot;,&quot;);</span><br><span class="line">            sqlBuilder.append(rowBounds.getLimit());</span><br><span class="line">            pageKey.update(rowBounds.getOffset());</span><br><span class="line">        &#125;</span><br><span class="line">        pageKey.update(rowBounds.getLimit());</span><br><span class="line">        return sqlBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>封装分页SQL，使我们不需要每个地方都去写分页的查询信息，同时，使我们select的SQL语言向下兼容，换了数据库也不需要更改SQL代码。</p>
<h2 id="2-pageHelper-应用举例"><a href="#2-pageHelper-应用举例" class="headerlink" title="2. pageHelper 应用举例"></a>2. pageHelper 应用举例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line">参数：</span><br><span class="line">package com.diditech.iov.inventory.domain;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line">import com.diditech.iov.core.utils.QueryParam;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 4S店库存车辆管理请求参数</span><br><span class="line"> * @author wangnn</span><br><span class="line"> * @date 2018/9/4 15:10</span><br><span class="line"> */</span><br><span class="line">public class VehicleManagementQueryParam extends QueryParam&#123;</span><br><span class="line"></span><br><span class="line">    //排序</span><br><span class="line">    @JSONField(serialize = false)</span><br><span class="line">    private final static Map&lt;String,String[]&gt; sortMap = new HashMap();</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        sortMap.put(&quot;insatlltime&quot;,new String[]&#123;&quot;cvi.INSTALL_TIME&quot;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getSort_desc() &#123;</span><br><span class="line">        return parseDESCSortParamMulti(sort_desc, sortMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getSort_asc() &#123;</span><br><span class="line">        return parseASCSortParamMulti(sort_asc, sortMap);</span><br><span class="line">    &#125;</span><br><span class="line">    //----------------------请求参数--------------------------</span><br><span class="line">    /**</span><br><span class="line">     * 仓库ID</span><br><span class="line">     */</span><br><span class="line">        private Integer wareHouseId;</span><br><span class="line">    /**</span><br><span class="line">     * 入库开始时间 年-月-日</span><br><span class="line">     */</span><br><span class="line">    private Date startTime;</span><br><span class="line">    /**</span><br><span class="line">     * 入库结束时间</span><br><span class="line">     */</span><br><span class="line">    private Date endTime;</span><br><span class="line">    /**</span><br><span class="line">     * 设备编号  返回一样</span><br><span class="line">     */</span><br><span class="line">    private String deviceNum;</span><br><span class="line">    //-----------------------返回参数------------------------------</span><br><span class="line">    /**</span><br><span class="line">     * 车型</span><br><span class="line">     */</span><br><span class="line">    private String vehicleType;</span><br><span class="line">    /**</span><br><span class="line">     * 车系</span><br><span class="line">     */</span><br><span class="line">    private String vehicleSerie;</span><br><span class="line">    /**</span><br><span class="line">     * 车架号</span><br><span class="line">     */</span><br><span class="line">    private String frameNo;</span><br><span class="line">    /**</span><br><span class="line">     * 所属仓库名称</span><br><span class="line">     */</span><br><span class="line">    private String wareHoseName;</span><br><span class="line">    /**</span><br><span class="line">     * 安装时间</span><br><span class="line">     */</span><br><span class="line">    private Date installDate;</span><br><span class="line">//    /**</span><br><span class="line">//     * 安装时间</span><br><span class="line">//     */</span><br><span class="line">//    private String installDateStr;</span><br><span class="line">    /**</span><br><span class="line">     *  入库时间</span><br><span class="line">     */</span><br><span class="line">    private Date wareHousingTime;</span><br><span class="line">//    /**</span><br><span class="line">//     * 返回前端 入库时间</span><br><span class="line">//     */</span><br><span class="line">//    private String wareHousingTimeStr;</span><br><span class="line">    /**</span><br><span class="line">     * sim卡号</span><br><span class="line">     */</span><br><span class="line">    private String simNum;</span><br><span class="line">    /**</span><br><span class="line">     * 车辆管理状态 -- 解押</span><br><span class="line">     */</span><br><span class="line">    private Byte detentionState;</span><br><span class="line">//    /**</span><br><span class="line">//     * 车辆管理状态 -- 解押</span><br><span class="line">//     */</span><br><span class="line">//    private String detentionStateStr;</span><br><span class="line">    /**</span><br><span class="line">     * 解押时间</span><br><span class="line">     */</span><br><span class="line">    private Date  detentionTime;</span><br><span class="line">//    /**</span><br><span class="line">//     * 解押时间</span><br><span class="line">//     */</span><br><span class="line">//    private String detentionTimeStr;</span><br><span class="line">    /**</span><br><span class="line">     * 车辆管理状态 -- 转售</span><br><span class="line">     */</span><br><span class="line">    private Byte resaleState;</span><br><span class="line">//    /**</span><br><span class="line">//     * 车辆管理状态 -- 转售</span><br><span class="line">//     */</span><br><span class="line">//    private String resaleStateStr;</span><br><span class="line">    /**</span><br><span class="line">     * 转售时间</span><br><span class="line">     */</span><br><span class="line">    private Date  resaleTime;</span><br><span class="line">//    /**</span><br><span class="line">//     * 转售时间</span><br><span class="line">//     */</span><br><span class="line">//    private String resaleTimeStr;</span><br><span class="line">    /**</span><br><span class="line">     * 车辆ID</span><br><span class="line">     */</span><br><span class="line">    private Integer vehicleId;</span><br><span class="line"></span><br><span class="line">    public static Map&lt;String, String[]&gt; getSortMap() &#123;</span><br><span class="line">        return sortMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getWareHouseId() &#123;</span><br><span class="line">        return wareHouseId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWareHouseId(Integer wareHouseId) &#123;</span><br><span class="line">        this.wareHouseId = wareHouseId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getStartTime() &#123;</span><br><span class="line">        return startTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStartTime(Date startTime) &#123;</span><br><span class="line">        this.startTime = startTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getEndTime() &#123;</span><br><span class="line">        return endTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setEndTime(Date endTime) &#123;</span><br><span class="line">        this.endTime = endTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDeviceNum() &#123;</span><br><span class="line">        return deviceNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDeviceNum(String deviceNum) &#123;</span><br><span class="line">        this.deviceNum = deviceNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getVehicleType() &#123;</span><br><span class="line">        return vehicleType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setVehicleType(String vehicleType) &#123;</span><br><span class="line">        this.vehicleType = vehicleType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getVehicleSerie() &#123;</span><br><span class="line">        return vehicleSerie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setVehicleSerie(String vehicleSerie) &#123;</span><br><span class="line">        this.vehicleSerie = vehicleSerie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFrameNo() &#123;</span><br><span class="line">        return frameNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFrameNo(String frameNo) &#123;</span><br><span class="line">        this.frameNo = frameNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getWareHoseName() &#123;</span><br><span class="line">        return wareHoseName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWareHoseName(String wareHoseName) &#123;</span><br><span class="line">        this.wareHoseName = wareHoseName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getInstallDate() &#123;</span><br><span class="line">        return installDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setInstallDate(Date installDate) &#123;</span><br><span class="line">        this.installDate = installDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getWareHousingTime() &#123;</span><br><span class="line">        return wareHousingTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setWareHousingTime(Date wareHousingTime) &#123;</span><br><span class="line">        this.wareHousingTime = wareHousingTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSimNum() &#123;</span><br><span class="line">        return simNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSimNum(String simNum) &#123;</span><br><span class="line">        this.simNum = simNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Byte getDetentionState() &#123;</span><br><span class="line">        return detentionState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDetentionState(Byte detentionState) &#123;</span><br><span class="line">        this.detentionState = detentionState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getDetentionTime() &#123;</span><br><span class="line">        return detentionTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDetentionTime(Date detentionTime) &#123;</span><br><span class="line">        this.detentionTime = detentionTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Byte getResaleState() &#123;</span><br><span class="line">        return resaleState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResaleState(Byte resaleState) &#123;</span><br><span class="line">        this.resaleState = resaleState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getResaleTime() &#123;</span><br><span class="line">        return resaleTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setResaleTime(Date resaleTime) &#123;</span><br><span class="line">        this.resaleTime = resaleTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getVehicleId() &#123;</span><br><span class="line">        return vehicleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setVehicleId(Integer vehicleId) &#123;</span><br><span class="line">        this.vehicleId = vehicleId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">QueryParam：</span><br><span class="line">package com.diditech.iov.core.utils;</span><br><span class="line"></span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">import javax.validation.constraints.Min;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.lang3.StringUtils;</span><br><span class="line">import org.hibernate.validator.constraints.Length;</span><br><span class="line">import org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line">import com.diditech.iov.core.exception.BusinessException;</span><br><span class="line">/**</span><br><span class="line"> * 分页排序 共通过滤 参数</span><br><span class="line"> * @author Lionel</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class QueryParam &#123;</span><br><span class="line">	//final static String regEX = &quot;[`~!@#$%^&amp;*()+=|&#123;&#125;&apos;:;&apos;,\\[\\].&lt;&gt;/?~！@#￥%……&amp;*（）——+|&#123;&#125;【】‘；：”“’。，、？]&quot;;</span><br><span class="line">	//若支持前天传多列排序 则使用regEX2</span><br><span class="line">	//final static String regEX2 = &quot;[`~!@#$%^&amp;*()+=|&#123;&#125;&apos;:;&apos;\\[\\].&lt;&gt;/?~！@#￥%……&amp;*（）——+|&#123;&#125;【】‘；：”“’。，、？]&quot;;</span><br><span class="line">	final static String ASC = &quot; ASC &quot;;</span><br><span class="line">	final static String DESC = &quot; DESC &quot;;</span><br><span class="line">	</span><br><span class="line">	private static Environment env;</span><br><span class="line">	&#123;</span><br><span class="line">		env = (Environment)ApplicationContextUtils.getBean(&quot;environment&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public QueryParam()&#123;</span><br><span class="line">		page_size = env.getProperty(&quot;custome.page.size&quot;);</span><br><span class="line">		page_index = &quot;1&quot;;//默认第一页</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 记录条数 page_size</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=10)</span><br><span class="line">	@Min(0)</span><br><span class="line">	protected String page_size;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 记录页数 page_index</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=10)</span><br><span class="line">	protected String page_index;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 忽略条数 offset</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=10)</span><br><span class="line">	protected String offset;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 最大条数 limit</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=10)</span><br><span class="line">	protected String limit;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 降序排序，多个用逗号分隔 sort_desc</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=30)</span><br><span class="line">	protected String sort_desc;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 降序排序，多个用逗号分隔 sort_asc</span><br><span class="line">	 */</span><br><span class="line">	@Length(min=0, max=30)</span><br><span class="line">	protected String sort_asc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public String getPage_size() &#123;</span><br><span class="line">		return page_size;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">//	暂时后台统一配置</span><br><span class="line">//	public void setPage_size(String page_size) &#123;</span><br><span class="line">//		this.page_size = page_size;</span><br><span class="line">//	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public String getPage_index() &#123;</span><br><span class="line">		return page_index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setPage_index(String page_index) &#123;</span><br><span class="line">		this.page_index = page_index;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public String getOffset() &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			if(StringUtils.isBlank(offset)&amp;&amp;StringUtils.isNotBlank(this.page_index)&amp;&amp;StringUtils.isNotBlank(this.page_size))&#123;</span><br><span class="line">				int pageIndex = Integer.valueOf(page_index);</span><br><span class="line">				int pageSize = Integer.valueOf(page_size);</span><br><span class="line">				int offSetTemp = (pageIndex-1)*pageSize;</span><br><span class="line">				return String.valueOf(offSetTemp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			throw new BusinessException(&quot;查询参数异常&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		return offset;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setOffset(String offset) &#123;</span><br><span class="line">		this.offset = offset;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public String getLimit() &#123;</span><br><span class="line">		if(StringUtils.isBlank(limit)&amp;&amp;StringUtils.isNotBlank(this.page_size))&#123;</span><br><span class="line">			return page_size;</span><br><span class="line">		&#125;</span><br><span class="line">		return limit;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setLimit(String limit) &#123;</span><br><span class="line">		this.limit = limit;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//public abstract String getSort_desc();</span><br><span class="line">	public String getSort_desc() &#123;</span><br><span class="line">		return sort_desc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setSort_desc(String sort_desc) &#123;</span><br><span class="line">		this.sort_desc = sort_desc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//public abstract String getSort_asc();</span><br><span class="line">	public String getSort_asc() &#123;</span><br><span class="line">		return sort_asc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setSort_asc(String sort_asc) &#123;</span><br><span class="line">		this.sort_asc = sort_asc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 判断分页排序参数是否为空</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public boolean isEmply()&#123;</span><br><span class="line">		if(StringUtils.isNotBlank(getPage_index())||StringUtils.isNotBlank(getOffset())||</span><br><span class="line">				StringUtils.isNotBlank(sort_asc)||StringUtils.isNotBlank(sort_desc))&#123;</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 判断排序参数是否为空</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public boolean sortParamIsEmply()&#123;</span><br><span class="line">		if(StringUtils.isNotBlank(sort_asc)||StringUtils.isNotBlank(sort_desc))&#123;</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 根据排序map创建</span><br><span class="line">	 * @param shortString</span><br><span class="line">	 * @param sortMap</span><br><span class="line">	 * @return</span><br><span class="line">	 * @deprecated 废弃</span><br><span class="line">	 */</span><br><span class="line">	public String parseSortParam(String sortString, Map&lt;String, String&gt; sortMap)&#123;</span><br><span class="line">		if(StringUtils.isBlank(sortString))&#123;</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line">		String temp = sortString.replaceAll(StringTools.regEX_PUNCTUATION, &quot;&quot;);</span><br><span class="line">		String result = &quot;&quot;;</span><br><span class="line">		temp = temp.toLowerCase();</span><br><span class="line">		if(StringUtils.isNotBlank(temp))&#123;</span><br><span class="line">			String[] tempArr = temp.split(&quot;,&quot;);</span><br><span class="line">			for(String str: tempArr)&#123;</span><br><span class="line">				String temp2 = sortMap.get(str);</span><br><span class="line">				if(StringUtils.isNoneBlank(temp2))&#123;</span><br><span class="line">					result += temp2;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if(StringUtils.isEmpty(result))&#123;</span><br><span class="line">			throw new BusinessException(&quot;排序参数异常！&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		return result;</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 根据排序map创建正序字符串</span><br><span class="line">	 * @param shortString</span><br><span class="line">	 * @param sortMap</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public String parseASCSortParamMulti(String sortString, Map&lt;String, String[]&gt; sortMap)&#123;</span><br><span class="line">		return parseSortParamMulti(ASC, sortString, sortMap);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 根据排序map创建倒序字符串</span><br><span class="line">	 * @param shortString</span><br><span class="line">	 * @param sortMap</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public String parseDESCSortParamMulti(String sortString, Map&lt;String, String[]&gt; sortMap)&#123;</span><br><span class="line">		return parseSortParamMulti(DESC, sortString, sortMap);</span><br><span class="line">	&#125;</span><br><span class="line">	private String parseSortParamMulti(String type, String sortString, Map&lt;String, String[]&gt; sortMap)&#123;</span><br><span class="line">		if(StringUtils.isBlank(sortString))&#123;</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line">		String temp = sortString.replaceAll(StringTools.regEX_PUNCTUATION, &quot;&quot;);</span><br><span class="line">		StringBuffer result = new StringBuffer(&quot;&quot;);</span><br><span class="line">		temp = temp.toLowerCase();</span><br><span class="line">		if(StringUtils.isNotBlank(temp))&#123;</span><br><span class="line">			String[] tempArr = temp.split(&quot;,&quot;);</span><br><span class="line">			for(String str: tempArr)&#123;</span><br><span class="line">				String[] temp2 = sortMap.get(str);</span><br><span class="line">				if(temp2==null)&#123;</span><br><span class="line">					throw new BusinessException(&quot;排序参数不合法！&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">				for(int ii=0;ii&lt;temp2.length;ii++)&#123;</span><br><span class="line">					if(StringUtils.isNoneBlank(temp2[ii]))&#123;</span><br><span class="line">						result.append(temp2[ii]).append(type).append(&quot;,&quot;);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if(StringUtils.isEmpty(result))&#123;</span><br><span class="line">			throw new BusinessException(&quot;排序参数异常！&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		result.deleteCharAt(result.length()-1);</span><br><span class="line">		return result.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">controller:</span><br><span class="line">@AccessLogger(value = &quot;库存车辆管理查询&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/info&quot;, method = RequestMethod.GET)</span><br><span class="line">    @ApiOperation(value = &quot;库存车辆管理查询&quot;, httpMethod = &quot;GET&quot;,</span><br><span class="line">            response = ResponseMessage.class, notes = &quot;库存车辆管理查询&quot;)</span><br><span class="line">    public ResponseMessage getVehicleManagementInfo(VehicleManagementQueryParam vehicleManagementQueryParam) &#123;</span><br><span class="line">        //前端 拼接时间</span><br><span class="line">        Page&lt;VehicleManagementQueryParam&gt; vehicleManagementList =</span><br><span class="line">                vehicleManagementService.getVehicleManagementInfo(vehicleManagementQueryParam);</span><br><span class="line">        return ResponseMessage.ok(new PageInfo&lt;VehicleManagementQueryParam&gt;(vehicleManagementList));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">service:</span><br><span class="line">@Override</span><br><span class="line">    public Page&lt;VehicleManagementQueryParam&gt; getVehicleManagementInfo(VehicleManagementQueryParam vehicleManagementQueryParam) &#123;</span><br><span class="line">        AccUser loginUser = ContextUtils.getLoginUser();</span><br><span class="line">        Integer shopId = loginUser.getCustomerId();</span><br><span class="line">        //安装时间倒序</span><br><span class="line">        if (vehicleManagementQueryParam.sortParamIsEmply()) &#123;</span><br><span class="line">            vehicleManagementQueryParam.setSort_desc(&quot;insatlltime&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        PageHelper.startPage(Integer.valueOf(vehicleManagementQueryParam.getPage_index()),</span><br><span class="line">                Integer.valueOf(vehicleManagementQueryParam.getPage_size()));</span><br><span class="line">        List&lt;VehicleManagementQueryParam&gt; vehicleManagementList =</span><br><span class="line">                vehicleManagementMapper.getVehicleManagementInfo(vehicleManagementQueryParam, shopId);</span><br><span class="line">        return (Page&lt;VehicleManagementQueryParam&gt;) vehicleManagementList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mapper:</span><br><span class="line">&lt;select id=&quot;getVehicleManagementInfo&quot;</span><br><span class="line">            resultType=&quot;com.diditech.iov.inventory.domain.VehicleManagementQueryParam&quot;&gt;</span><br><span class="line">        SELECT</span><br><span class="line">        cvi.VEHICLE_ID vehicleId,</span><br><span class="line">        cvi.VEHICLE_BRAND_NAME vehicleType,</span><br><span class="line">        cvi.VEHICLE_SERIES vehicleSerie,</span><br><span class="line">        cvi.PLATE_NUM frameNo,</span><br><span class="line">        cvi.WAREHOUSE_NAME wareHoseName,</span><br><span class="line">        cvi.INSTALL_TIME installDate,</span><br><span class="line">        cvi.INVENTORY_TIME wareHousingTime,</span><br><span class="line">        cvi.DEVICE_NUM deviceNum,</span><br><span class="line">        cvi.SIM_NUM simNum,</span><br><span class="line">        cvi.ISRELEASED detentionState,</span><br><span class="line">        cvi.RELEASE_TIME detentionTime,</span><br><span class="line">        cvi.ISFORRESALE resaleState,</span><br><span class="line">        cvi.RESALE_TIME resaleTime</span><br><span class="line">        FROM</span><br><span class="line">        dd_new.inventory_rpt_current cvi</span><br><span class="line">        INNER JOIN dd_new.inventory_vehicle_ref vr</span><br><span class="line">        ON vr.VEHICLE_ID = cvi.VEHICLE_ID</span><br><span class="line">        WHERE</span><br><span class="line">        vr.customer_4s_id = #&#123;shopId&#125;</span><br><span class="line">        &lt;if test=&quot;vehicleManagementQueryParam.wareHouseId != null&quot; &gt;</span><br><span class="line">            AND vr.WAREHOUSE_ID = #&#123;vehicleManagementQueryParam.wareHouseId&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;vehicleManagementQueryParam.startTime != null&quot; &gt;</span><br><span class="line">            AND cvi.INVENTORY_TIME &amp;gt;= #&#123;vehicleManagementQueryParam.startTime&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;vehicleManagementQueryParam.endTime != null&quot; &gt;</span><br><span class="line">            AND cvi.INVENTORY_TIME &amp;lt;= #&#123;vehicleManagementQueryParam.endTime&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;vehicleManagementQueryParam.deviceNum != null and vehicleManagementQueryParam.deviceNum != &apos;&apos;&quot;&gt;</span><br><span class="line">            AND cvi.DEVICE_NUM LIKE CONCAT (&apos;%&apos;,#&#123;vehicleManagementQueryParam.deviceNum&#125;,&apos;%&apos;)</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;vehicleManagementQueryParam.sort_desc != null and vehicleManagementQueryParam.sort_desc != &apos;&apos;&quot; &gt;</span><br><span class="line">            ORDER BY $&#123;vehicleManagementQueryParam.sort_desc&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/14/pageHelper-分页应用/" data-id="cjnv46xtq0005rshxucr0nafu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pageHelper-分页应用/">pageHelper 分页应用</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-RESTful-API" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/05/RESTful-API/" class="article-date">
  <time datetime="2018-09-05T09:24:17.000Z" itemprop="datePublished">2018-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/05/RESTful-API/">RESTful API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="路径定义"><a href="#路径定义" class="headerlink" title="路径定义"></a>路径定义</h1><h2 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h2><p>在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。</p>
<p>为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /v1/users/&#123;user_id&#125;  // 版本 v1 的查询用户列表的 API 接口</span><br><span class="line">【GET】  /v2/users/&#123;user_id&#125;  // 版本 v2 的查询用户列表的 API 接口</span><br></pre></td></tr></table></figure>
<p>现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。</p>
<p>注意的是，“不改变版本 v1 的查询用户列表的 API 接口”主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的API 接口上。</p>
<h2 id="资源路径"><a href="#资源路径" class="headerlink" title="资源路径"></a>资源路径</h2><p>RESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /v1/tags/&#123;tag_id&#125;</span><br></pre></td></tr></table></figure>
<p>同时，资源的路径应该从根到子依次如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#123;resources&#125;/&#123;resource_id&#125;/&#123;sub_resources&#125;/&#123;sub_resource_id&#125;/&#123;sub_resource_property&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看一个“添加用户的角色”的设计，其中“用户”是主资源，“角色”是子资源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【POST】  /v1/users/&#123;user_id&#125;/roles/&#123;role_id&#125; // 添加用户的角色</span><br></pre></td></tr></table></figure>
<p>有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#123;resources&#125;/&#123;resource_id&#125;/actions/&#123;action&#125;</span><br></pre></td></tr></table></figure>
<p>举个例子，“密码修改”这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【PUT】  /v1/users/&#123;user_id&#125;/password/actions/modify // 密码修改</span><br></pre></td></tr></table></figure>
<p>当路径中出现多个单词时，请使用中划线 <code>-</code> 来连接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /v1/order/my-orders // 获取我的订单信息</span><br></pre></td></tr></table></figure>
<h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中，GET 用于查询资源，POST 用于创建资源，PUT 用于更新服务端的资源的全部信息，PATCH 用于更新服务端的资源的部分信息，DELETE 用于删除服务端的资源。</p>
<p>这里，笔者使用“用户”的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">【GET】          /users                # 查询用户信息列表</span><br><span class="line">【GET】          /users/1001           # 查看某个用户信息</span><br><span class="line">【POST】         /users                # 新建用户信息</span><br><span class="line">【PUT】          /users/1001           # 更新用户信息(全部字段)</span><br><span class="line">【PATCH】        /users/1001           # 更新用户信息(部分字段)</span><br><span class="line">【DELETE】       /users/1001           # 删除用户信息</span><br></pre></td></tr></table></figure>
<h2 id="查询参数"><a href="#查询参数" class="headerlink" title="查询参数"></a>查询参数</h2><p>RESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;?offset=0&amp;limit=20</span><br></pre></td></tr></table></figure>
<p>同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;?orderby=&#123;field&#125; [asc|desc]</span><br></pre></td></tr></table></figure>
<p>为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;?count=[true|false]</span><br></pre></td></tr></table></figure>
<p>上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【GET】  /v1/categorys/&#123;category_id&#125;/apps/&#123;app_id&#125;?enable=[1|0]&amp;os_type=&#123;field&#125;&amp;device_ids=&#123;field,field,…&#125;</span><br></pre></td></tr></table></figure>
<p>注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。</p>
<h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><p>使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举笔者在实际开发过程中常用的一些状态码，以供参考。</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th style="text-align:right">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td style="text-align:right">请求成功</td>
</tr>
<tr>
<td>201</td>
<td style="text-align:right">创建成功</td>
</tr>
<tr>
<td>400</td>
<td style="text-align:right">错误的请求</td>
</tr>
<tr>
<td>401</td>
<td style="text-align:right">未验证</td>
</tr>
<tr>
<td>403</td>
<td style="text-align:right">被拒绝</td>
</tr>
<tr>
<td>404</td>
<td style="text-align:right">无法找到</td>
</tr>
<tr>
<td>409</td>
<td style="text-align:right">资源冲突</td>
</tr>
<tr>
<td>500</td>
<td style="text-align:right">服务器内部错误</td>
</tr>
</tbody>
</table>
<h2 id="异常响应"><a href="#异常响应" class="headerlink" title="异常响应"></a>异常响应</h2><p>当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&#123;error message&#125;&quot;,</span><br><span class="line">    &quot;cause&quot;: &quot;&#123;cause message&#125;&quot;,</span><br><span class="line">    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;host_id&quot;: &quot;&#123;server identity&#125;&quot;,</span><br><span class="line">    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h2><p>在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">【GET】     /v1/users/batch?user_ids=1001,1002      // 批量查询用户信息</span><br><span class="line">参数说明</span><br><span class="line">- user_ids: 用户ID串，最多允许 20 个。</span><br></pre></td></tr></table></figure>
<p>此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">【POST】     /v1/users                             // 创建用户信息</span><br><span class="line">请求内容</span><br><span class="line">&#123;</span><br><span class="line">    &quot;username&quot;: &quot;lgz&quot;,                 // 必填, 用户名称, max 10</span><br><span class="line">    &quot;realname&quot;: &quot;梁桂钊&quot;,               // 必填, 用户名称, max 10</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;,              // 必填, 用户密码, max 32</span><br><span class="line">    &quot;email&quot;: &quot;lianggzone@163.com&quot;,     // 选填, 电子邮箱, max 32</span><br><span class="line">    &quot;weixin&quot;: &quot;LiangGzone&quot;,            // 选填，微信账号, max 32</span><br><span class="line">    &quot;sex&quot;: 1                           // 必填, 用户性别[1-男 2-女 99-未知]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="响应参数"><a href="#响应参数" class="headerlink" title="响应参数"></a>响应参数</h2><p>针对不同操作，服务端向用户返回的结果应该符合以下规范。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">【GET】     /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;      // 返回单个资源对象</span><br><span class="line">【GET】     /&#123;version&#125;/&#123;resources&#125;                    // 返回资源对象的列表</span><br><span class="line">【POST】    /&#123;version&#125;/&#123;resources&#125;                    // 返回新生成的资源对象</span><br><span class="line">【PUT】     /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;      // 返回完整的资源对象</span><br><span class="line">【PATCH】   /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;      // 返回完整的资源对象</span><br><span class="line">【DELETE】  /&#123;version&#125;/&#123;resources&#125;/&#123;resource_id&#125;      // 状态码 200，返回完整的资源对象。</span><br><span class="line">                                                      // 状态码 204，返回一个空文档</span><br></pre></td></tr></table></figure>
<p>如果是单条数据，则返回一个对象的 JSON 字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">    &quot;created_time&quot;: 1496676420000,</span><br><span class="line">    &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是列表数据，则返回一个封装的结构体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;count&quot;:100,</span><br><span class="line">    &quot;items&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">            &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">            &quot;created_time&quot;: 1496676420000,</span><br><span class="line">            &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="一个完整的案例"><a href="#一个完整的案例" class="headerlink" title="一个完整的案例"></a>一个完整的案例</h2><p>最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用“获取用户列表”的案例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">【GET】     /v1/users?[&amp;keyword=xxx][&amp;enable=1][&amp;offset=0][&amp;limit=20] 获取用户列表</span><br><span class="line">功能说明：获取用户列表</span><br><span class="line">请求方式：GET</span><br><span class="line">参数说明</span><br><span class="line">- keyword: 模糊查找的关键字。[选填]</span><br><span class="line">- enable: 启用状态[1-启用 2-禁用]。[选填]</span><br><span class="line">- offset: 获取位置偏移，从 0 开始。[选填]</span><br><span class="line">- limit: 每次获取返回的条数，缺省为 20 条，最大不超过 100。 [选填]</span><br><span class="line">响应内容</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;count&quot;:100,</span><br><span class="line">    &quot;items&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">            &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">            &quot;created_time&quot;: 1496676420000,</span><br><span class="line">            &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">失败响应</span><br><span class="line">HTTP/1.1 403 UC/AUTH_DENIED</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&#123;error message&#125;&quot;,</span><br><span class="line">    &quot;cause&quot;: &quot;&#123;cause message&#125;&quot;,</span><br><span class="line">    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;host_id&quot;: &quot;&#123;server identity&#125;&quot;,</span><br><span class="line">    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;</span><br><span class="line">&#125;</span><br><span class="line">错误代码</span><br><span class="line">- 403 UC/AUTH_DENIED    授权受限</span><br></pre></td></tr></table></figure>
<h1 id="参数接收"><a href="#参数接收" class="headerlink" title="参数接收"></a>参数接收</h1><p>本篇文章主要说下接口的数据参数到底该如何接收，我们知道一个http请求最重要的意义就是将数据在服务器上进行传入与传出，本章主要讲的也就是传入。一次请求传递参数的方式主要有 URL路径中、请求头中、请求体中还有通过cookie等，下面我们分别对几种方式进行讲解。</p>
<h2 id="MediaType的选择"><a href="#MediaType的选择" class="headerlink" title="MediaType的选择"></a>MediaType的选择</h2><p>MediaType即是Internet Media Type，互联网媒体类型；也叫做MIME类型，在Http协议消息头中，使用Content-Type来表示具体请求中的媒体类型信息。</p>
<p>对于POST、PUT、PATCH这种HTTP方法，统一使用 application/json，将参数放在请求体中以JSON格式传递至服务器<br>对于GET、DELETE的HTTP方法，使用默认类型（application/x-www-form-urlencoded）<br>★备注<br>特殊情况特殊考虑，例如进行文件上传时，使用 multipart/form-data类型等</p>
<h2 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h2><p>对应spring mvc框架中@PathVariable注解</p>
<p>接收参数方式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public ResponseMessage get(@PathVariable(&quot;customerId&quot;)int customerId)&#123;</span><br><span class="line">	//...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="请求头参数"><a href="#请求头参数" class="headerlink" title="请求头参数"></a>请求头参数</h2><p>对应spring mvc框架中@RequestHeader注解</p>
<p>对于提供给APP（android、ios、pc） 的接口我们可能需要关注一些调用信息，例如 用户登录信息、调用来源、app版本号、api的版本号、安全验证信息 等等，我们将这些信息放入头信息（HTTP HEAD中），下面给出在参数命名的例子：</p>
<p>Access-Token 用户的登录token（用于置换用户登录信息）<br>Api-Version api的版本号<br>App-Version app版本号<br>Call-Source 调用来源(IOS、ANDROID、PC、WECHAT、WEB)<br>Authorization 安全校验参数（后面会有文章详细介绍该如何做安全校验）<br>这时你可能会思考一下几个问题：</p>
<p>为什么需要收集 api版本号、app版本号、调用来源这些信息呢？<br>这里解释下，主要有几个原因：<br>①方便线上环境定位问题，这也是一个重要的原因（我们后面会讲通过切面全局打印非GET请求的接口调用日志）。<br>②我们可以通过这些参数信息处理我们的业务逻辑，而没有必要在用到的时候我们才想起来让调用者将信息传递过来，导致同一功能性的参数，参数名和参数值不统一的情况发生。<br>是每个接口都要这些参数么？<br>是的，建议将所有的接口都传递上述参数信息。<br>怎么做这些参数的校验呢？<br>你可以写个拦截器，统一校验你的接口中全局的header参数<br>★备注 </p>
<ul>
<li>Header参数大小写不敏感，所以参数Access-Token和ACCESS-TOKEN是一个参数</li>
</ul>
<h2 id="请求体参数"><a href="#请求体参数" class="headerlink" title="请求体参数"></a>请求体参数</h2><p>参数传递分为了大体两种 URL请求查询参数、请求体参数，对于请求体参数我们选择以JSON格式传递过来，URL请求查询参数、请求体参数这两种方式分别对应了spring mvc框架中的 @RequestParam、@RequestBody两个注解进行修饰。<br>我们下面以添加一个用户举例，用POSTMAN截图如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7477749-c6fdcdc835d413f7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建用户"></p>
<h2 id="开发实例"><a href="#开发实例" class="headerlink" title="开发实例"></a>开发实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import javax.validation.Valid;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.http.HttpStatus;</span><br><span class="line">import org.springframework.web.bind.annotation.DeleteMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import com.zhuma.demo.comm.model.po.User;</span><br><span class="line">import com.zhuma.demo.user.service.user.UserService;</span><br><span class="line">import com.github.pagehelper.PageInfo;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 用户管理控制器</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/users&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    private final UserService userService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public UserController(UserService userService) &#123;</span><br><span class="line">        this.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    public PageInfo&lt;User&gt; getUserList(@RequestParam(name=&quot;pageNum&quot;, defaultValue=&quot;1&quot;) Integer pageNum, </span><br><span class="line">                                      @RequestParam(name=&quot;pageSize&quot;, defaultValue=&quot;10&quot;) Integer pageSize,</span><br><span class="line">                                        @RequestParam(name=&quot;queryUser&quot;) User queryUser) &#123;</span><br><span class="line">        return userService.pageList(queryUser, pageNum, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/&#123;userId&#125;&quot;)</span><br><span class="line">    User getUser(@PathVariable(&quot;userId&quot;) Long userId) &#123;</span><br><span class="line">        return userService.getUserById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping</span><br><span class="line">    @ResponseStatus(HttpStatus.CREATED)</span><br><span class="line">    public User addUser(@Valid @RequestBody User user) &#123;</span><br><span class="line">        return userService.register(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PutMapping</span><br><span class="line">    public User updateUser(@RequestBody User user) &#123;</span><br><span class="line">        return userService.updateDbAndCache(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;/&#123;userId&#125;&quot;)</span><br><span class="line">    @ResponseStatus(HttpStatus.NO_CONTENT)</span><br><span class="line">    void deleteUser(@PathVariable(&quot;userId&quot;) Long userId) &#123;</span><br><span class="line">        userService.deleteUserById(userId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面我们截取一个管理用户的功能控制器，其中可能有一些你不了解的注解，例如@Valid、@ResponseStatus，@Valid一般配合参数校验使用，@ResponseStatus直接修饰目标方法，不管是否触发异常，都会返回指定的异常和错误码，这里我们主要看@GetMapping、@PostMapping、 @PutMapping、@DeleteMapping 分别处理查询、修改、删除功能，@RequestParam、@RequestBody 分别表示 查询参数、json body请求体参数。</p>
<h1 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h1><h2 id="格式选择"><a href="#格式选择" class="headerlink" title="格式选择"></a>格式选择</h2><p>返回格式目前主流的应该只有XML、JSON两种吧，这里我们不做对比，我们使用JSON作为接口的返回格式。</p>
<h2 id="数据返回格式"><a href="#数据返回格式" class="headerlink" title="数据返回格式"></a>数据返回格式</h2><p>数据的返回格式其实是个比较纠结的问题，在restful风格中很多文章都讲解使用的是http状态码控制请求的结果状态，例如：http状态码为200~300的时候，为正常状态，response响应体即为所需要返回的数据，404时代表没有查询到数据，响应体即为空，500为系统错误，响应体也为空等等，但是这种方式也是存在很大问题的，一是http状态码是有限的，而且每个状态码都已经被赋予特殊的含义，在企业开发中当接口遇到错误的时候，我们可能更希望将结果状态码标记的更为详细，更利于前端开发者使用，毕竟写接口的目的也是方便前端使用，这样也可以降低前后端开发人员沟通成本。<br>下面给出我们在实际开发中使用的返回值统一格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">public class ResponseMessage implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = 8992436576262574064L;</span><br><span class="line">    /**</span><br><span class="line">     * 是否成功</span><br><span class="line">     */</span><br><span class="line">    private boolean success;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 反馈数据</span><br><span class="line">     */</span><br><span class="line">    private Object data;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 反馈信息</span><br><span class="line">     */</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 响应码</span><br><span class="line">     */</span><br><span class="line">    private int code;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 过滤字段：指定需要序列化的字段</span><br><span class="line">     */</span><br><span class="line">    private transient Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; includes;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 过滤字段：指定不需要序列化的字段</span><br><span class="line">     */</span><br><span class="line">    private transient Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; excludes;</span><br><span class="line"></span><br><span class="line">    private transient boolean onlyData;</span><br><span class="line"></span><br><span class="line">    private transient String callback;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Object&gt; toMap() &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;success&quot;, this.success);</span><br><span class="line">        if (data != null)</span><br><span class="line">            map.put(&quot;data&quot;, this.getData());</span><br><span class="line">        if (message != null)</span><br><span class="line">            map.put(&quot;message&quot;, this.getMessage());</span><br><span class="line">        map.put(&quot;code&quot;, this.getCode());</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage() &#123;&#125;</span><br><span class="line">    protected ResponseMessage(String message) &#123;</span><br><span class="line">        this.code = 500;</span><br><span class="line">        this.message = message;</span><br><span class="line">        this.success = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data) &#123;</span><br><span class="line">        this.code = success ? 200 : 500;</span><br><span class="line">        this.data = data;</span><br><span class="line">        this.success = success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data ,Object message) &#123;</span><br><span class="line">        this.code = success ? 200 : 500;</span><br><span class="line">        this.data = data;</span><br><span class="line">        this.success = success;</span><br><span class="line">        this.message = (String)message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data, int code) &#123;</span><br><span class="line">        this(success, data);</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Class&lt;?&gt; type, String... fields) &#123;</span><br><span class="line">        return include(type, Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Class&lt;?&gt; type, Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (includes == null)</span><br><span class="line">            includes = new HashMap&lt;&gt;();</span><br><span class="line">        if (fields == null || fields.isEmpty()) return this;</span><br><span class="line">        fields.forEach(field -&gt; &#123;</span><br><span class="line">            if (field.contains(&quot;.&quot;)) &#123;</span><br><span class="line">                String tmp[] = field.split(&quot;[.]&quot;, 2);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Field field1 = type.getDeclaredField(tmp[0]);</span><br><span class="line">                    if (field1 != null) &#123;</span><br><span class="line">                        include(field1.getType(), tmp[1]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Throwable e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                getStringListFormMap(includes, type).add(field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Class&lt;?&gt; type, Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (excludes == null)</span><br><span class="line">            excludes = new HashMap&lt;&gt;();</span><br><span class="line">        if (fields == null || fields.isEmpty()) return this;</span><br><span class="line">        fields.forEach(field -&gt; &#123;</span><br><span class="line">            if (field.contains(&quot;.&quot;)) &#123;</span><br><span class="line">                String tmp[] = field.split(&quot;[.]&quot;, 2);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Field field1 = type.getDeclaredField(tmp[0]);</span><br><span class="line">                    if (field1 != null) &#123;</span><br><span class="line">                        exclude(field1.getType(), tmp[1]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Throwable e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                getStringListFormMap(excludes, type).add(field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (excludes == null)</span><br><span class="line">            excludes = new HashMap&lt;&gt;();</span><br><span class="line">        if (fields == null || fields.isEmpty()) return this;</span><br><span class="line">        Class&lt;?&gt; type;</span><br><span class="line">        if (data != null) type = data.getClass();</span><br><span class="line">        else return this;</span><br><span class="line">        exclude(type, fields);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (includes == null)</span><br><span class="line">            includes = new HashMap&lt;&gt;();</span><br><span class="line">        if (fields == null || fields.isEmpty()) return this;</span><br><span class="line">        Class&lt;?&gt; type;</span><br><span class="line">        if (data != null) type = data.getClass();</span><br><span class="line">        else return this;</span><br><span class="line">        include(type, fields);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Class&lt;?&gt; type, String... fields) &#123;</span><br><span class="line">        return exclude(type, Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(String... fields) &#123;</span><br><span class="line">        return exclude(Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(String... fields) &#123;</span><br><span class="line">        return include(Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected Set&lt;String&gt; getStringListFormMap(Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; map, Class&lt;?&gt; type) &#123;</span><br><span class="line">        Set&lt;String&gt; list = map.get(type);</span><br><span class="line">        if (list == null) &#123;</span><br><span class="line">            list = new HashSet&lt;&gt;();</span><br><span class="line">            map.put(type, list);</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isSuccess() &#123;</span><br><span class="line">        return success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSuccess(boolean success) &#123;</span><br><span class="line">        this.success = success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Object getData() &#123;</span><br><span class="line">        return data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage setData(Object data) &#123;</span><br><span class="line">        this.data = data;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return JSON.toJSONStringWithDateFormat(this, DateTimeUtils.YEAR_MONTH_DAY_HOUR_MINUTE_SECOND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage setCode(int code) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage fromJson(String json) &#123;</span><br><span class="line">        return JSON.parseObject(json, ResponseMessage.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; getExcludes() &#123;</span><br><span class="line">        return excludes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; getIncludes() &#123;</span><br><span class="line">        return includes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage onlyData() &#123;</span><br><span class="line">        setOnlyData(true);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOnlyData(boolean onlyData) &#123;</span><br><span class="line">        this.onlyData = onlyData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isOnlyData() &#123;</span><br><span class="line">        return onlyData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage callback(String callback) &#123;</span><br><span class="line">        this.callback = callback;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCallback() &#123;</span><br><span class="line">        return callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMessage() &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMessage(String message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage ok() &#123;</span><br><span class="line">        return ok(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage created(Object data) &#123;</span><br><span class="line">        return new ResponseMessage(true, data, 201);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage ok(Object data) &#123;</span><br><span class="line">        return new ResponseMessage(true, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage error(String message) &#123;</span><br><span class="line">        return new ResponseMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage error(String message, int code) &#123;</span><br><span class="line">        return new ResponseMessage(message).setCode(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/05/RESTful-API/" data-id="cjnv46xt80000rshxqcnqolof" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RESTful-API/">RESTful API</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTful-API/">RESTful API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idea/">idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pageHelper-分页应用/">pageHelper 分页应用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/服务器restart-sh脚本中的含义/">服务器restart.sh脚本中的含义</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/用命令行把项目部署到github/">用命令行把项目部署到github</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/RESTful-API/" style="font-size: 10px;">RESTful API</a> <a href="/tags/idea/" style="font-size: 10px;">idea</a> <a href="/tags/pageHelper-分页应用/" style="font-size: 10px;">pageHelper 分页应用</a> <a href="/tags/服务器restart-sh脚本中的含义/" style="font-size: 10px;">服务器restart.sh脚本中的含义</a> <a href="/tags/用命令行把项目部署到github/" style="font-size: 10px;">用命令行把项目部署到github</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/23/本地IDEA调试远程服务器程序/">本地IDEA调试远程服务器程序</a>
          </li>
        
          <li>
            <a href="/2018/10/23/本地Eclipse调试远程服务器程序/">本地Eclipse调试远程服务器程序</a>
          </li>
        
          <li>
            <a href="/2018/10/23/Sql中and、or、union、union-all-的用法/">Sql中and、or、union、union all 的用法</a>
          </li>
        
          <li>
            <a href="/2018/10/22/Nginx-转发-域名配置/">Nginx 转发 + 域名配置</a>
          </li>
        
          <li>
            <a href="/2018/10/16/inert-into-select语句使用/">inert-into-select语句使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>