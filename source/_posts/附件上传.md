---
title: 附件上传
date: 2018-11-15 14:57:50
tags:
---
![猫咪老师](/images/页面图片/18.jpg)
## 配置文件配置上传大小参数
```
#修改上传文件大小设置，全局有效
spring.http.multipart.maxFileSize=5Mb
spring.http.multipart.maxRequestSize=5Mb
#附件保存文件夹
fileDir=E:/guizi
```
## controller
```
//上传附件文件类型白名单
private final String[] FILE_WHITE = {".zip,", ".xls", ".doc", ".jpeg", ".jpg", ".png", ".pdf", ".docx", ".xlsx"};
@AccessLogger(value = "上传附件")
@RequestMapping(value = "/upload/save", method = RequestMethod.POST)
@ApiOperation(value = "上传附件", httpMethod = "POST",
        response = ResponseMessage.class, notes = "上传附件")
public ResponseMessage uploadFile(@RequestParam(value = "file")  MultipartFile file,
                                      @RequestParam(value = "fileName") String fileName) {
    if (StringUtils.isEmpty(fileName)) {
            throw new BusinessException("文件名不能为空");
       }
    LOG.debug("文件名" + fileName);
    final String fileType = fileName.substring(fileName.lastIndexOf("."));
    final List<String> list = Arrays.asList(FILE_WHITE);
    if (file.isEmpty() || file.getSize() == 0) {
            throw new BusinessException("文件不能为空");
    }
    if (!list.contains(fileType)) {
            throw new BusinessException("文件类型不在允许的范围内");
     }
    final List<Integer> fileIds = new ArrayList<>(1);
    fileIds.add(certificateService.fileSave(file, fileName));
    return ResponseMessage.ok(fileIds.get(0));
}    
```
## service
```
@Value("${fileDir}")
private String fileDir;
public Integer fileSave(MultipartFile file, String fileName) {
     try {
     //保存文件信息到数据库表
        final RfidFile rfidFile = new RfidFile();
        rfidFile.setFilename(fileName);
        rfidFileMapper.insertSelective(rfidFile);
        final byte[] bytes = file.getBytes();
        final String fileType = fileName.substring(fileName.lastIndexOf("."));
        final Path path = Paths.get(fileDir + File.separator + rfidFile.getId() + fileType);
        LOG.debug("文件路径：" + path.toString());
        Files.write(path, bytes);
        rfidFile.setPath(path.toString());
        rfidFile.setUploadtime(new Date());
        rfidFileMapper.updateByPrimaryKey(rfidFile);
        return rfidFile.getId();
     } catch (Exception e) {
      LOG.error("文件保存异常：", e);
      throw new BusinessException("文件保存出现异常");
      }
}
```