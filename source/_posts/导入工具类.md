---
title: 导入工具类
date: 2018-11-15 16:28:09
tags:
---
![猫咪老师](/images/页面图片/10.jpeg)
导入工具 随着Excel内容变化
```
public class ImportExcel<T> {

    /**
     * Excel03正则
     */
    private static final String REG_EXCEL_03 = "^.+\\.(?i)(xls)$";
    /**
     * Excel07正则
     */
    private static final String REG_EXCEL_07 = "^.+\\.(?i)(xlsx)$";

    /**
     * 默认，第一个sheet
     * @date 2018/11/10 11:27
     */
    private static final int FIRST_SHEET_INDEX = 0;

    private ImportExcel() {
    }

    public static ImportExcel getInstance(){
        return new ImportExcel();
    }

    /**
     * 判断是否为excel文件
     * @date 2018/11/10 14:22
     */
    public static boolean isNotExcelFile(String fileName){
        return ExcelType.UNKNOWN.equals(getExcelType(fileName));
    }

    /**
     * 根据文件名获取Excle类型
     *
     * @param fileName
     * @return
     */
    public static ExcelType getExcelType(String fileName) {
        if (StringUtils.isEmpty(fileName)){
            return ExcelType.UNKNOWN;
        }
        if (fileName.matches(REG_EXCEL_03)){
            return ExcelType.EXCEL03;
        }
        if (fileName.matches(REG_EXCEL_07)){
            return ExcelType.EXCEL07;
        }
        return ExcelType.UNKNOWN;
    }

    /**
     * 根据excel model获取data
     * @author hefan
     * @date 2018/11/10 11:28
     * @param multipartFile
     * @param clazz
     * @return
     * @throws IllegalAccessException
     * @throws IOException
     * @throws InstantiationException
     */
    public List<T> getDataByExcelModel(MultipartFile multipartFile, Class<T> clazz)
            throws IllegalAccessException, IOException, InstantiationException{
        return getDataByExcelModel(multipartFile.getInputStream(),
                multipartFile.getOriginalFilename(), clazz, FIRST_SHEET_INDEX);
    }

    /**
     * 根据excel model获取data
     * @date 2018/11/10 11:28
     * @param multipartFile
     * @param clazz
     * @param sheetIndex
     * @return
     * @throws IllegalAccessException
     * @throws IOException
     * @throws InstantiationException
     */
    public List<T> getDataByExcelModel(MultipartFile multipartFile, Class<T> clazz, int sheetIndex)
            throws IllegalAccessException, IOException, InstantiationException{
        if (null == multipartFile){
            throw new BusinessException("未上传文件");
        }
        return getDataByExcelModel(multipartFile.getInputStream(),
                multipartFile.getOriginalFilename(), clazz, sheetIndex);
    }

    /**
     * 根据excel model获取data
     * @date 2018/11/10 11:28
     * @param input
     * @param fileName
     * @param clazz
     * @return
     * @throws IllegalAccessException
     * @throws IOException
     * @throws InstantiationException
     */
    public List<T> getDataByExcelModel(InputStream input, String fileName, Class<T> clazz)
            throws IllegalAccessException, IOException, InstantiationException {
        return getDataByExcelModel(input, fileName, clazz, FIRST_SHEET_INDEX);
    }

    /**
     * 根据excel model获取data
     * @date 2018/11/10 11:28
     * @param input
     * @param fileName
     * @param clazz
     * @param sheetIndex
     * @return
     * @throws IllegalAccessException
     * @throws IOException
     * @throws InstantiationException
     */
    public List<T> getDataByExcelModel(InputStream input, String fileName,
                                       Class<T> clazz, int sheetIndex)
            throws IllegalAccessException, IOException, InstantiationException {
        if(null == input){
            throw new BusinessException("上传内容为空");
        }
        Workbook workbook = null;
        ExcelType excelType = getExcelType(fileName);
        try {
            if (excelType == ExcelType.EXCEL03){
                workbook = new HSSFWorkbook(input);
            }
            else{
                workbook = new XSSFWorkbook(input);
            }
            Sheet sheet = workbook.getSheetAt(sheetIndex);
            XlsRecord recordAnnotation = AnnotationUtils.findAnnotation(clazz, XlsRecord.class);
            XlsCell[] cells = recordAnnotation.cells();

            int rows = sheet.getPhysicalNumberOfRows();
            if (rows < 1){
                throw new BusinessException("未找到导入信息！");
            }

            List<T> list  = new ArrayList<>();
            // 获取反射行
            for (int i = 1; i < rows; i++) {
                Row row = sheet.getRow(i);
                if (null == row || ExcelUtils.checkExcelRowIsNull(row)){
                    continue;
                }

                T value = clazz.newInstance();
                for (int c = 0; c < cells.length; c++) {
                    Cell cell = row.getCell(c);
                    String property = cells[c].objFieldName();
                    Field field = FieldUtils.getField(clazz, property, true);
                    if (null == field){
                        throw new BusinessException("未找到属性:" + property);
                    }
                    if (field.getType().equals(Date.class)) {
                        Date tmp2 = DateTimeUtils.formatDateString(cell.getRichStringCellValue().toString(),
                                DateTimeUtils.YEAR_MONTH_DAY_HOUR_MINUTE_SECOND_SUPER_SIMPLE_6);
                        FieldUtils.writeField(value, property, tmp2, true);
                    } else if (field.getType().equals(Integer.class) || field.getType().equals(Short.class)
                            || field.getType().equals(Byte.class)) {
                        FieldUtils.writeField(value, property,
                                ConvertUtils.convert(cell.getNumericCellValue(), field.getType()), true);
                    } else {
                        if(null != cell){
                            cell.setCellType(Cell.CELL_TYPE_STRING);
                            FieldUtils.writeField(value, property,
                                    ConvertUtils.convert(cell.getStringCellValue(), field.getType()), true);
                        }
                    }
                }
                list.add(value);
            }
            return list;
        } finally {
            if (null != workbook){
                workbook.close();
            }
        }
    }

    /**
     * Excel 类型，根据后缀名不同可分为03和07，两种类型解析方式不同
     * @author liuns 2017年5月8日上午8:53:36
     *
     */
    public enum ExcelType {
        /**
         * 后缀是xls的
         */
        EXCEL03,
        /**
         * 后缀是xlsx的
         */
        EXCEL07,
        /**
         * 未知
         */
        UNKNOWN
    }

}

```
用法 ：
```
List<CertificateExcelInfo> lists = ImportExcel.getInstance().getDataByExcelModel(file, CertificateExcelInfo.class);
```