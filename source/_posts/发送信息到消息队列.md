---
title: 发送信息到消息队列
date: 2019-04-24 16:21:00
tags:
---

发送信息到指定消息队列：
```
public class PTAlarmSender {
    private static final Logger log = LoggerFactory.getLogger(PTAlarmSender.class);

    public static void sendQueue(AlmDataDTO almData) {
        try {
            /**
             * Step 1. 获取队列引用
             */
            Environment env = (Environment) ApplicationContextUtils.getBean("environment");
            CloudQueue queue = AliyunUtils.getMNSClient().getQueueRef(env.getProperty("pt.alarm.queue"));
            /**
             * Step 2. 设置发送消息
             */
            String messageBody = JSON.toJSONString(almData);
            Message message = new Message();
            message.setMessageBody(messageBody);

            /**
             * Step 3. 发送消息
             */
            Message putMsg = queue.putMessage(message);
            String messageId = putMsg.getMessageId();
            log.info("平台预警发送器messageId={}",messageId);
        } catch (Exception e) {
            log.error("平台预警发送器异常",e);
            throw new BusinessException("平台预警发送器异常:" + e.getMessage());
        }
    }

}
```

上述代码写在core工程，引用在webapi工程，core工程pom.xml不引用webapi工程依赖，webapi工程pom引用了core依赖，项目在打包时，core工程作为其中一个jar包打包。
```
Environment env = (Environment) ApplicationContextUtils.getBean("environment");
```
此段代码取得是调用方的有效配置文件。